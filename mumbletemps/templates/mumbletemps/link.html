{% extends 'mumbletemps/base.html' %}
{% load i18n %}
{% load humanize %}
{% load timetags %}
{% load static %}

{% block create %}
<div style="margin-top:25px">
    <div class="col-md-12 text-center">
        <img class="ra-avatar img-circle" src="{{link.creator.portrait_url_128}}"><br><br>
        <h4>{{link.creator.character_name}} has invited you to join Mumble!</h4>
        <p>Time Remaining: <span id="countdown{{link.link_ref}}"></span></p>
        <p><span class="label label-info">Link Ref: {{link.link_ref}}</span></p>
            <br>
        <a class="btn btn-primary" href="mumble://{{ connect_url }}"><img src="https://upload.wikimedia.org/wikipedia/commons/thumb/8/8f/Icons_mumble.svg/400px-Icons_mumble.svg.png" alt="Mumble" height="64" width="64" style="margin: 15px;"><span style="margin: 15px;">Launch Mumble!</span></div></a>

    </div>
</div>
{% endblock %}

{% block extra_javascript %}   
{% include 'bundles/moment-js.html' with locale=True %}
<script src="{% static 'js/timers.js' %}"></script>
<script type="text/javascript">
    var locale = "{{ LANGUAGE_CODE }}";

    var timers = [
            {
                'id': "{{ link.link_ref }}",
                'targetDate': moment("{{ link.expires|print_timestamp| date:"c" }}"),
                'expired': false
            }
    ];

    moment.locale(locale);

    // Set initial values
    timedUpdate();

    // Start timed updates
    setInterval(timedUpdate, 1000);

    function timedUpdate() {
        updateAllTimers();
    }

    function updateAllTimers () {
        var l = timers.length;
        for (var i=0; i < l; ++i) {
            if (timers[i].expired) continue;
            updateTimer(timers[i]);
        }
    }

    /**
     * Update a timer
     * @param timer Timer information
     * @param timer.targetDate Date of the timer
     * @param timer.id Id number of the timer
     * @param timer.expired
     */
    function updateTimer(timer) {
        if (timer.targetDate.isAfter(Date.now())) {
            duration = moment.duration(timer.targetDate - moment(), 'milliseconds');
            document.getElementById("countdown" + timer.id).innerHTML = getDurationString(duration);
        } else {
            timer.expired = true;
            document.getElementById("countdown" + timer.id).innerHTML = "";
        }
    }

</script>

{% endblock %}

{% block extra_css %}    
{% endblock %}

{% block extra_script %}    

{% endblock %}

